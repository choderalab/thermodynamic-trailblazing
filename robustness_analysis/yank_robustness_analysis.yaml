---

options:
  verbose: yes
  resume_setup: yes
  resume_simulation: yes
  output_dir: .
  setup_dir: ../yank/setup

  temperature: 298.15*kelvin
  pressure: 1*atmosphere
  hydrogen_mass: 3.0 * amu
  constraints: HBonds
  anisotropic_dispersion_cutoff: auto

  minimize: yes
  default_number_of_iterations: 0
  # Each iteration is about 1ps/replica.
  default_nsteps_per_iteration: 286
  default_timestep: 3.5*femtoseconds
  checkpoint_interval: 1000

  annihilate_electrostatics: yes
  annihilate_sterics: no
  alchemical_pme_treatment: exact


# Molecules
# ---------

oe_charges: &oe_charges
  openeye:
    quacpac: am1-bcc
  antechamber:
    charge_method: null

common_BRD4-ligands: &common_BRD4-ligands
  filepath: ../yank/input/ligands-BRD4.mol2
  <<: *oe_charges

molecules:
  CB8:
    filepath: ../yank/input/CB8.mol2
    <<: *oe_charges
  CB8-ligands:
    # We only consider CB8-G0/2/3/5/6/7/8/9/10 since the others are either
    # part of the bonus challenge or have weird stoichiometry.
    filepath: ../yank/input/ligands-CB8.mol2
    select: all
    <<: *oe_charges

  T4-L99A:
    filepath: ../yank/input/l99a-55.mcce.pdb
  T4-L99A-ligands:
    filepath: ../yank/input/ligands-l99a-1-16.mol2
    select: all
    <<: *oe_charges

  # TODO: Remove multiple molecules when SMARTS regions are implemented

  BRD4:
    filepath: ../yank/input/4BJX-clean.pdb
  BRD4-ligands_0:
    select: 0
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [37, 36, 21] # C18, N1, C11 [2158, 2157, 2142]
    <<: *common_BRD4-ligands
  BRD4-ligands_1:
    select: 1
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [23, 22, 21] # C11, N1, C10 [2144, 2143, 2142]
    <<: *common_BRD4-ligands
  BRD4-ligands_2:
    select: 2
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [22, 21, 20] # C11, N1, C10 [2143, 2142, 2141]
    <<: *common_BRD4-ligands
  BRD4-ligands_3:
    select: 3
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [22, 21, 20] # C11, N1, C10 [2143, 2142, 2141]
    <<: *common_BRD4-ligands
  BRD4-ligands_4:
    select: 4
    regions:
      ligand_harmonic_atoms: name N2
      ligand_boresch_atoms: [33, 32, 17] # C15, N2, C8 [2154, 2153, 2138]
    <<: *common_BRD4-ligands
  BRD4-ligands_5:
    select: 5
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [36, 35, 20] # C18, N1, C11 [2157, 2156, 2141]
    <<: *common_BRD4-ligands
  BRD4-ligands_6:
    select: 6
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [22, 21, 20] # C11, N1, C10 [2143, 2142, 2141]
    <<: *common_BRD4-ligands
  BRD4-ligands_7:
    select: 7
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [8, 9, 29] # C3, N1, C13 [2129, 2130, 2150]
    <<: *common_BRD4-ligands
  BRD4-ligands_8:
    select: 8
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [37, 36, 21] # C18, N1, C11 [2158, 2157, 2142]
    <<: *common_BRD4-ligands
  BRD4-ligands_9:
    select: 9
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [22, 21, 20] # C11, N1, C10 [2143, 2142, 2141]
    <<: *common_BRD4-ligands
  BRD4-ligands_10:
    select: 10
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [25, 24, 23] # C12, N1, C11 [2146, 2145, 2144]
    <<: *common_BRD4-ligands
  BRD4-ligands_11:
    select: 11
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [28, 27, 26] # C13, N1, C12 [2149, 2148, 2147]
    <<: *common_BRD4-ligands
  BRD4-ligands_12:
    select: 12
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [28, 27, 26] # C13, N1, C12 [2149, 2148, 2147]
    <<: *common_BRD4-ligands
  BRD4-ligands_13:
    select: 13
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [25, 24, 23] # C12, N1, C11 [2146, 2145, 2144]
    <<: *common_BRD4-ligands
  BRD4-ligands_14:
    select: 14
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [22, 21, 20] # C11, N1, C10 [2143, 2142, 2141]
    <<: *common_BRD4-ligands
  BRD4-ligands_15:
    select: 15
    regions:
      ligand_harmonic_atoms: name N1
      ligand_boresch_atoms: [22, 21, 20] # C11, N1, C10 [2143, 2142, 2141]
    <<: *common_BRD4-ligands


# Solvents
# --------

common_PME: &common_PME
  nonbonded_method: PME
  clearance: 12*angstroms
  nonbonded_cutoff: 11*angstroms
  switch_distance: 10*angstroms
  ewald_error_tolerance: 1.0e-4
  negative_ion: Cl-
  positive_ion: Na+
  solvent_model: tip3p

solvents:
  PME-neutral:  # For bromodomains
    <<: *common_PME
  PME-50mM-acetate:  # For T4
    <<: *common_PME
    ionic_strength: 43.44*millimolar
  PME-25mM-sodium: # For CB8
    <<: *common_PME
    ionic_strength: 57.8*millimolar  # 3.1mM NaH2PO4 + 21.9mM NaOH


# Systems
# -------

systems:
  CB8-system:
    receptor: CB8
    ligand: CB8-ligands
    solvent: PME-25mM-sodium
    leap:
      parameters: [leaprc.protein.ff14SB, leaprc.water.tip3p, leaprc.gaff2]

  T4-system:
    receptor: T4-L99A
    ligand: T4-L99A-ligands
    solvent: PME-50mM-acetate
    leap:
      parameters: [leaprc.protein.ff14SB, leaprc.water.tip3p, leaprc.gaff2]

  BRD4-system:
    receptor: BRD4
    ligand: !Combinatorial [BRD4-ligands_0, BRD4-ligands_1, BRD4-ligands_2, BRD4-ligands_3, BRD4-ligands_4, BRD4-ligands_5, BRD4-ligands_6, BRD4-ligands_7, BRD4-ligands_8, BRD4-ligands_9, BRD4-ligands_10, BRD4-ligands_11, BRD4-ligands_12, BRD4-ligands_13, BRD4-ligands_14, BRD4-ligands_15]
    solvent: PME-neutral
    leap:
      parameters: [leaprc.protein.ff14SB, leaprc.water.tip3p, leaprc.gaff2]



# Experiments
# -----------

protocols:
  forward-05-bidirectional:
    complex:
      trailblazer_options:
        reversed_direction: no
        thermodynamic_distance: 0.5
      alchemical_path: auto
    solvent:
      trailblazer_options:
        reversed_direction: no
        thermodynamic_distance: 0.5
      alchemical_path: auto

  reverse-05-bidirectional:
    complex:
      trailblazer_options:
        reversed_direction: yes
        thermodynamic_distance: 0.5
      alchemical_path: auto
    solvent:
      trailblazer_options:
        reversed_direction: yes
        thermodynamic_distance: 0.5
      alchemical_path: auto

  forward-10-bidirectional:
    complex:
      trailblazer_options:
        reversed_direction: no
        thermodynamic_distance: 1.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        reversed_direction: no
        thermodynamic_distance: 1.0
      alchemical_path: auto

  reverse-10-bidirectional:
    complex:
      trailblazer_options:
        reversed_direction: yes
        thermodynamic_distance: 1.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        reversed_direction: yes
        thermodynamic_distance: 1.0
      alchemical_path: auto

  forward-20-bidirectional:
    complex:
      trailblazer_options:
        reversed_direction: no
        thermodynamic_distance: 2.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        reversed_direction: no
        thermodynamic_distance: 2.0
      alchemical_path: auto

  reverse-20-bidirectional:
    complex:
      trailblazer_options:
        reversed_direction: yes
        thermodynamic_distance: 2.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        reversed_direction: yes
        thermodynamic_distance: 2.0
      alchemical_path: auto

  forward-05-unidirectional:
    complex:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: no
        thermodynamic_distance: 0.5
      alchemical_path: auto
    solvent:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: no
        thermodynamic_distance: 0.5
      alchemical_path: auto

  reverse-05-unidirectional:
    complex:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: yes
        thermodynamic_distance: 0.5
      alchemical_path: auto
    solvent:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: yes
        thermodynamic_distance: 0.5
      alchemical_path: auto

  forward-10-unidirectional:
    complex:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: no
        thermodynamic_distance: 1.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: no
        thermodynamic_distance: 1.0
      alchemical_path: auto

  reverse-10-unidirectional:
    complex:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: yes
        thermodynamic_distance: 1.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: yes
        thermodynamic_distance: 1.0
      alchemical_path: auto

  forward-20-unidirectional:
    complex:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: no
        thermodynamic_distance: 2.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: no
        thermodynamic_distance: 2.0
      alchemical_path: auto

  reverse-20-unidirectional:
    complex:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: yes
        thermodynamic_distance: 2.0
      alchemical_path: auto
    solvent:
      trailblazer_options:
        bidirectional_redistribution: no
        reversed_direction: yes
        thermodynamic_distance: 2.0
      alchemical_path: auto


restraint_CB8: &restraint_CB8
  restraint:
    type: Harmonic
    restrained_ligand_atoms: (resname MOL) and (mass > 1.5)
    restrained_receptor_atoms: (resname HST) and (mass > 1.5)
    spring_constant: 0.3 * kilocalories_per_mole/(angstrom**2)

experiment-CB8-bidirectional:
  system: !Combinatorial [CB8-system, CB8-system, CB8-system, CB8-system, CB8-system]
  protocol: !Combinatorial [forward-05-bidirectional, reverse-05-bidirectional, forward-10-bidirectional, reverse-10-bidirectional, forward-20-bidirectional, reverse-20-bidirectional]
  <<: *restraint_CB8

experiment-CB8-unidirectional:
  system: !Combinatorial [CB8-system, CB8-system, CB8-system, CB8-system, CB8-system]
  protocol: !Combinatorial [forward-05-unidirectional, reverse-05-unidirectional, forward-10-unidirectional, reverse-10-unidirectional, forward-20-unidirectional, reverse-20-unidirectional]
  <<: *restraint_CB8


restraint_T4: &restraint_T4
  restraint:
    type: Harmonic
    restrained_ligand_atoms: (resname MOL) and (mass > 1.5)
    restrained_receptor_atoms: (resi 77 or resi 83 or resi 86 or resi 87 or resi 90 or resi 98 or resi 101 or resi 102 or resi 110 or resi 117 or resi 120 or resi 152) and (mass > 1.5)
    spring_constant: 0.5 * kilocalories_per_mole/(angstrom**2)

experiment-T4-bidirectional:
  system: !Combinatorial [T4-system, T4-system, T4-system, T4-system, T4-system]
  protocol: !Combinatorial [forward-05-bidirectional, reverse-05-bidirectional, forward-10-bidirectional, reverse-10-bidirectional, forward-20-bidirectional, reverse-20-bidirectional]
  <<: *restraint_T4

experiment-T4-unidirectional:
  system: !Combinatorial [T4-system, T4-system, T4-system, T4-system, T4-system]
  protocol: !Combinatorial [forward-05-unidirectional, reverse-05-unidirectional, forward-10-unidirectional, reverse-10-unidirectional, forward-20-unidirectional, reverse-20-unidirectional]
  <<: *restraint_T4


restraint_BRD4: &restraint_BRD4
  restraint:
    type: Harmonic
    restrained_receptor_atoms: (resi 40 or resi 45 or resi 55 or resi 98 or resi 104) and (name CA or name C or name N)
    restrained_ligand_atoms: ligand_harmonic_atoms
    spring_constant: 0.3 * kilocalories_per_mole/(angstrom**2)
    #type: Boresch
    #restrained_receptor_atoms: [940, 923, 921] # [941, 924, 922]
    #restrained_ligand_atoms: ligand_boresch_atoms
    #K_r: 10.0 * kilocalories_per_mol / angstrom**2
    #K_thetaA: 10.0 * kilocalories_per_mol / angstrom**2
    #K_thetaB: 10.0 * kilocalories_per_mol / angstrom**2
    #K_phiA: 10.0 * kilocalories_per_mol / angstrom**2
    #K_phiB: 10.0 * kilocalories_per_mol / angstrom**2
    #K_phiC: 10.0 * kilocalories_per_mol / angstrom**2

experiment-BRD4-bidirectional:
  system: !Combinatorial [BRD4-system, BRD4-system, BRD4-system, BRD4-system, BRD4-system]
  protocol: !Combinatorial [forward-05-bidirectional, reverse-05-bidirectional, forward-10-bidirectional, reverse-10-bidirectional, forward-20-bidirectional, reverse-20-bidirectional]
  <<: *restraint_BRD4

experiment-BRD4-unidirectional:
  system: !Combinatorial [BRD4-system, BRD4-system, BRD4-system, BRD4-system, BRD4-system]
  protocol: !Combinatorial [forward-05-unidirectional, reverse-05-unidirectional, forward-10-unidirectional, reverse-10-unidirectional, forward-20-unidirectional, reverse-20-unidirectional]
  <<: *restraint_BRD4


experiments: [experiment-CB8-bidirectional, experiment-CB8-unidirectional, experiment-T4-bidirectional, experiment-T4-unidirectional, experiment-BRD4-bidirectional, experiment-BRD4-unidirectional]
